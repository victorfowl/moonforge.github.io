<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Proyecto &ndash; Moonforge</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="../styles.css" rel="stylesheet">
</head>
<body>
    <header class="topbar">
        <div class="container nav-wrap">
            <a href="../index.html" class="brand">Moonforge</a>
            <nav class="nav">
                <a href="../services.html">Servicios</a>
                <a href="../portfolio.html">Portfolio</a>
                <a href="../contact.html">Contacto</a>
            </nav>
        </div>
    </header>

    <main class="container section">
        <h1 id="projTitle"></h1>
        <p id="projSubtitle" class="muted"></p>
        <div id="carousel" class="carousel"></div>
        <div id="projTags" class="tags"></div>

        <p style="margin-top:18px">
            <a href="../portfolio.html" class="more">← Volver al portfolio</a>
        </p>
    </main>

    <footer class="footer">
        <div class="container">&copy; <span id="year"></span> Moonforge</div>
    </footer>

    <!-- Carga main.js con defer para asegurar que dicts/funciones están disponibles -->
    <script src="../main.js" defer></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // slug desde query (?slug=) o desde el nombre del archivo projects/slug.html
                const slug = (new URLSearchParams(location.search)).get('slug')
                    || location.pathname.split('/').pop().replace('.html', '');

                if (document.getElementById('year')) {
                    document.getElementById('year').textContent = new Date().getFullYear();
                }

                // i18n (usa funciones de main.js)
                const dict = await loadJSON(dicts[LANG]);
                applyI18n(dict);

                // Busca el proyecto por slug en el JSON del idioma activo
                const items = await loadJSON(portfolioData[LANG]);
                const p = items.find(x => x.slug === slug);

                if (!p) {
                    document.getElementById('projTitle').textContent = 'Proyecto no encontrado';
                    document.getElementById('projSubtitle').textContent = '';
                    const c = document.getElementById('carousel');
                    if (c) c.innerHTML = '<div class="card" style="padding:16px">No se encontró el proyecto solicitado.</div>';
                    return;
                }

                document.getElementById('projTitle').textContent = p.title;
                document.getElementById('projSubtitle').textContent = p.subtitle || '';
                const tagsEl = document.getElementById('projTags');
                tagsEl.innerHTML = (p.tags || []).map(t => `<span class="tag">${t}</span>`).join('');

                // Carrusel (función definida en main.js)
                if (typeof renderCarousel === 'function') {
                    renderCarousel(document.getElementById('carousel'), p.media || [], p.thumb, p.video, p.poster);
                } else {
                    // Fallback simple si no está renderCarousel
                    const car = document.getElementById('carousel');
                    car.innerHTML = (p.media || [])
                        .map(m => m.type === 'image'
                            ? `<img src="${m.src}" alt="" style="width:100%;display:block;margin-bottom:10px">`
                            : `<video controls ${m.poster ? `poster="${m.poster}"` : ''} style="width:100%;display:block;margin-bottom:10px">
                     <source src="${m.src}" type="video/mp4">
                   </video>`
                        ).join('');
                }
            } catch (e) {
                console.error(e);
                const c = document.getElementById('carousel');
                if (c) c.innerHTML = '<div class="card" style="padding:16px">Se produjo un error cargando el proyecto.</div>';
            }
        });
    </script>
</body>
</html>
